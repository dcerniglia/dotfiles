let apiCall,getToday,notify;_631‍.w("./utils/helpers",[["apiCall",["apiCall"],function(v){apiCall=v}]]);_631‍.w("./utils/time",[["getToday",["getToday"],function(v){getToday=v}]]);_631‍.w("./utils/notifications",[["notify",["notify"],function(v){notify=v}]]);


const alfy = require('alfy');

const vars = process.env;
const { projectId, projectName, taskId, taskName } = vars;

const today = getToday();

const url = `https://api.harvestapp.com/v2/time_entries?project_id=${projectId}&task_id=${taskId}&spent_date=${today}`;

await apiCall(url, 'POST')
    .then(response => {
        if (response.is_running) {
            notify(
                'Harvest timer started!',
                `${projectName}, ${taskName}`
            );
        }
    })
    .catch(error => {
        if (error.message.includes('RequestError: getaddrinfo ENOTFOUND')) {
            notify(
                'Failed to start Harvest timer.',
                'Check your network connection and try again.'
            );
        }

        notify(error.message);
    });